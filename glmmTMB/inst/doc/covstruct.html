<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kasper Kristensen" />

<meta name="date" content="2019-07-19" />

<title>Covariance structures with glmmTMB</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Covariance structures with glmmTMB</h1>
<h4 class="author">Kasper Kristensen</h4>
<h4 class="date">2019-07-19</h4>



<p>This vignette demonstrates some of the covariance structures available in the <code>glmmTMB</code> package. Currently the available covariance structures are:</p>
<table>
<thead>
<tr class="header">
<th>Covariance</th>
<th>Notation</th>
<th>Parameter count</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Heterogeneous unstructured</td>
<td><code>us</code></td>
<td><span class="math inline">\(n(n+1)/2\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Heterogeneous Toeplitz</td>
<td><code>toep</code></td>
<td><span class="math inline">\(2n-1\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>Heterogeneous compound symmetry</td>
<td><code>cs</code></td>
<td><span class="math inline">\(n+1\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Heterogeneous diagonal</td>
<td><code>diag</code></td>
<td><span class="math inline">\(n\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>AR(1)</td>
<td><code>ar1</code></td>
<td><span class="math inline">\(2\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Ornstein–Uhlenbeck</td>
<td><code>ou</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="odd">
<td>Spatial exponential</td>
<td><code>exp</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="even">
<td>Spatial Gaussian</td>
<td><code>gau</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="odd">
<td>Spatial Matern</td>
<td><code>mat</code></td>
<td><span class="math inline">\(3\)</span></td>
<td>Coordinates</td>
</tr>
</tbody>
</table>
<p>The word ‘heterogeneous’ refers to the marginal variances of the model. Beyond correlation parameters, a heterogeneous structure uses <span class="math inline">\(n\)</span> additional variance parameters where <span class="math inline">\(n\)</span> is the dimension.</p>
<p>Some of the structures require temporal or spatial coordinates. We will show examples of this in a later section.</p>
<div id="the-ar1-covariance-structure" class="section level2">
<h2>The AR(1) covariance structure</h2>
<div id="demonstration-on-simulated-data" class="section level3">
<h3>Demonstration on simulated data</h3>
<p>First, let’s consider a simple time series model. Assume that our measurements <span class="math inline">\(Y(t)\)</span> are given at discrete times <span class="math inline">\(t \in \{1,...,n\}\)</span> by</p>
<p><span class="math display">\[Y(t) = \mu + X(t) + \varepsilon(t)\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the mean value parameter.</li>
<li><span class="math inline">\(X(t)\)</span> is a stationary AR(1) process, i.e. has covariance <span class="math inline">\(cov(X(s),  X(t)) = \sigma^2\exp(-\theta |t-s|)\)</span>.</li>
<li><span class="math inline">\(\varepsilon(t)\)</span> is iid. <span class="math inline">\(N(0,\sigma_0^2)\)</span> measurement error.</li>
</ul>
<p>A simulation experiment is set up using the parameters</p>
<table>
<thead>
<tr class="header">
<th>Description</th>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean</td>
<td><span class="math inline">\(\mu\)</span></td>
<td>0</td>
</tr>
<tr class="even">
<td>Process variance</td>
<td><span class="math inline">\(\sigma^2\)</span></td>
<td>1</td>
</tr>
<tr class="odd">
<td>Measurement variance</td>
<td><span class="math inline">\(\sigma_0^2\)</span></td>
<td>1</td>
</tr>
<tr class="even">
<td>One-step correlation</td>
<td><span class="math inline">\(e^{-\theta}\)</span></td>
<td>0.7</td>
</tr>
</tbody>
</table>
<p>The following R-code draws a simulation based on these parameter values. For illustration purposes we consider a very short time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">6</span>                                              ## Number of time points
x &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>,n),
             <span class="dt">Sigma =</span> .<span class="dv">7</span> ^<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist</span>(<span class="dv">1</span>:n)) )    ## Simulate the process using the MASS package
y &lt;-<span class="st"> </span>x +<span class="st"> </span><span class="kw">rnorm</span>(n)                                   ## Add measurement noise</code></pre></div>
<p>In order to fit the model with <code>glmmTMB</code> we must first specify a time variable as a <em>factor</em>. The factor <em>levels</em> correspond to unit spaced time points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">times &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="dv">1</span>:n)
<span class="kw">levels</span>(times)</code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</code></pre>
<p>We also need a grouping variable. In the current case there is only one time-series so the grouping is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>,n))</code></pre></div>
<p>We combine the data into a single data frame (not absolutely required, but good practice):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat0 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y,times,group)</code></pre></div>
<p>Now fit the model using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">ar1</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat0)</code></pre></div>
<p>This formula notation follows that of the <code>lme4</code> package.</p>
<ul>
<li>The left hand side of the bar <code>times + 0</code> corresponds to a design matrix <span class="math inline">\(Z\)</span> linking observation vector <span class="math inline">\(y\)</span> (rows) with a random effects vector <span class="math inline">\(u\)</span> (columns).</li>
<li>The distribution of <span class="math inline">\(u\)</span> is <code>ar1</code> (this is the only <code>glmmTMB</code> specific part of the formula).</li>
<li>The right hand side of the bar splits the above specification independently among groups. Each group has its own separate <span class="math inline">\(u\)</span> vector but shares the same parameters for the covariance structure.</li>
</ul>
<p>After running the model, we find the parameter estimates <span class="math inline">\(\mu\)</span> (intercept), <span class="math inline">\(\sigma_0^2\)</span> (dispersion), <span class="math inline">\(\sigma\)</span> (Std. Dev.) and <span class="math inline">\(e^{-\theta}\)</span> (First off-diagonal of “Corr”) in the output:</p>
<blockquote>
<p>FIXME: Try a longer time series when the print.VarCorr is fixed.</p>
</blockquote>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat0
##      AIC      BIC   logLik df.resid 
## 18.76343 17.93047 -5.38171        2 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev.  Corr       
##  group    times1 7.018e-01 -0.58 (ar1)
##  Residual        1.165e-05            
## 
## Number of obs: 6 / Conditional model: group, 1
## 
## Dispersion estimate for gaussian family (sigma^2): 1.36e-10 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##       1.072</code></pre>
</div>
<div id="increasing-the-sample-size" class="section level3">
<h3>Increasing the sample size</h3>
<p>A single time series of 6 time points is not sufficient to identify the parameters. We could either increase the length of the time series or increase the number of groups. We’ll try the latter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simGroup &lt;-<span class="st"> </span>function(g, <span class="dt">n=</span><span class="dv">6</span>, <span class="dt">rho=</span><span class="fl">0.7</span>) {
    x &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>,n),
             <span class="dt">Sigma =</span> rho ^<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist</span>(<span class="dv">1</span>:n)) )   ## Simulate the process
    y &lt;-<span class="st"> </span>x +<span class="st"> </span><span class="kw">rnorm</span>(n)                               ## Add measurement noise
    times &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="dv">1</span>:n)
    group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(g,n))
    <span class="kw">data.frame</span>(y, times, group)
}
<span class="kw">simGroup</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code>##           y times group
## 1 0.3008231     1     1
## 2 0.1835385     2     1
## 3 0.3750261     3     1
## 4 1.5819573     4     1
## 5 1.5776466     5     1
## 6 0.2072020     6     1</code></pre>
<p>Generate a dataset with 1000 groups:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">lapply</span>(<span class="dv">1</span>:<span class="dv">1000</span>, simGroup) )</code></pre></div>
<p>And fitting the model on this larger dataset gives estimates close to the true values (AR standard deviation=1, residual (measurement) standard deviation=1, autocorrelation=0.7):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(fit.ar1 &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">ar1</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1))</code></pre></div>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat1
##       AIC       BIC    logLik  df.resid 
##  20549.90  20576.70 -10270.95      5996 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev. Corr      
##  group    times1 1.003    0.72 (ar1)
##  Residual        1.019              
## 
## Number of obs: 6000 / Conditional model: group, 1000
## 
## Dispersion estimate for gaussian family (sigma^2): 1.04 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##     0.04378</code></pre>
</div>
</div>
<div id="the-unstructured-covariance" class="section level2">
<h2>The unstructured covariance</h2>
<p>We can try to fit an unstructured covariance to the previous dataset <code>dat</code>. For this case an unstructured covariance has 15 correlation parameters and 6 variance parameters. Adding <span class="math inline">\(\sigma_0^2 I\)</span> on top would cause a strict overparameterization, as these would be redundant with the diagonal elements in the covariance matrix. Hence, when fitting the model with <code>glmmTMB</code>, we have to disable the <span class="math inline">\(\varepsilon\)</span> term (the dispersion) by setting <code>dispformula=~0</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.us &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">us</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span>~<span class="dv">0</span>)
fit.us$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.us)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.4131                                 
##         times2 1.3898   0.353                         
##         times3 1.5018   0.273 0.384                   
##         times4 1.4040   0.166 0.216 0.352             
##         times5 1.4331   0.160 0.192 0.239 0.354       
##         times6 1.4375   0.108 0.136 0.195 0.273 0.345</code></pre>
<p>{#1_{{#2}}} The estimated correlation is approximately constant along diagonals (apparent Toeplitz structure) and we note that the first off-diagonal is now ca. half the true value (0.7) because the dispersion is effectively included in the estimated covariance matrix (i.e. <span class="math inline">\(\rho' = \rho {2}{\sigma^2}{AR}/({2}{\sigma^2}{AR} + {2}{sigma^2}{meas})\)</span>).</p>
</div>
<div id="the-toeplitz-structure" class="section level2">
<h2>The Toeplitz structure</h2>
<p>The next natural step would be to reduce the number of parameters by collecting correlation parameters within the same off-diagonal. This amounts to 5 correlation parameters and 6 variance parameters.</p>
<blockquote>
<p>FIXME: Explain why dispformula=~1 causes over-parameterization</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.toep &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">toep</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span>~<span class="dv">0</span>)
fit.toep$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(vc.toep &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.toep))</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.4126                                 
##         times2 1.3878   0.358                         
##         times3 1.4961   0.249 0.358                   
##         times4 1.4070   0.188 0.249 0.358             
##         times5 1.4369   0.148 0.188 0.249 0.358       
##         times6 1.4388   0.106 0.148 0.188 0.249 0.358</code></pre>
<p>The diagonal elements are all approximately equal to the true total variance (<span class="math inline">\({2}{\sigma^2}{AR} + {2}{sigma^2}{meas}\)</span>=2), and the off-diagonal elements are approximately equal to the expected value of 0.7/2=0.35.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vc1 &lt;-<span class="st"> </span>vc.toep$cond[[<span class="dv">1</span>]] ## first term of var-cov for RE of conditional model
<span class="kw">summary</span>(<span class="kw">diag</span>(vc1))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.926   1.984   2.030   2.046   2.069   2.238</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(vc1[<span class="kw">row</span>(vc1)!=<span class="kw">col</span>(vc1)])</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2159  0.3745  0.5045  0.5119  0.7178  0.7530</code></pre>
<p>We can get a <em>slightly</em> better estimate of the variance by using REML estimation (however, the estimate of the correlations seems to have gotten slightly worse):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.toep.reml &lt;-<span class="st"> </span><span class="kw">update</span>(fit.toep, <span class="dt">REML=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence
## (8). See vignette('troubleshooting')</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vc1R &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.toep.reml)$cond[[<span class="dv">1</span>]]
<span class="kw">summary</span>(<span class="kw">diag</span>(vc1R))</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.927   1.984   2.031   2.046   2.069   2.239</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(vc1R[<span class="kw">row</span>(vc1R)!=<span class="kw">col</span>(vc1R)])</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2167  0.3752  0.5053  0.5127  0.7185  0.7538</code></pre>
</div>
<div id="compound-symmetry" class="section level2">
<h2>Compound symmetry</h2>
<p>The compound symmetry structure collects all off-diagonal elements of the correlation matrix to one common value.</p>
<blockquote>
<p>FIXME: Explain why dispformula=~1 causes over-parameterization</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.cs &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">cs</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span>~<span class="dv">0</span>)
fit.cs$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.cs)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr      
##  group  times1 1.4312   0.250 (cs)</code></pre>
</div>
<div id="anova-tables" class="section level2">
<h2>Anova tables</h2>
<p>The models <code>ar1</code>, <code>toep</code>, and <code>us</code> are nested so we can use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(fit.ar1, fit.toep, fit.us)</code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.ar1: y ~ ar1(times + 0 | group), zi=~0, disp=~1
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
## fit.us: y ~ us(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## fit.ar1   4 20550 20577 -10271    20542                         
## fit.toep 12 20556 20637 -10266    20532 9.4895      8     0.3027
## fit.us   22 20570 20717 -10263    20526 6.5103     10     0.7707</code></pre>
<p><code>ar1</code> has the lowest AIC (it’s the simplest model, and fits the data adequately); we can’t reject the (true in this case!) null model that an AR1 structure is adequate to describe the data.</p>
<p>The model <code>cs</code> is a sub-model of <code>toep</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(fit.cs, fit.toep)</code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.cs: y ~ cs(times + 0 | group), zi=~0, disp=~0
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## fit.cs    8 20703 20756 -10343    20687                             
## fit.toep 12 20556 20637 -10266    20532 154.48      4  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Here we <em>can</em> reject the null hypothesis of compound symmetry (i.e., that all the pairwise correlations are the same).</p>
</div>
<div id="adding-coordinate-information" class="section level2">
<h2>Adding coordinate information</h2>
<p>Coordinate information can be added to a variable using the <code>glmmTMB</code> function <code>numFactor</code>. This is necessary in order to use those covariance structures that require coordinates. For example, if we have the numeric coordinates</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dv">10</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)
y &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dv">10</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>we can generate a factor representing <span class="math inline">\((x,y)\)</span> coordinates by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(pos &lt;-<span class="st"> </span><span class="kw">numFactor</span>(x,y))</code></pre></div>
<pre><code>##  [1] (2,1) (2,1) (1,1) (2,2) (2,2) (1,2) (2,1) (2,2) (1,1) (2,2)
## Levels: (1,1) (2,1) (1,2) (2,2)</code></pre>
<p>Numeric coordinates can be recovered from the factor levels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">parseNumLevels</span>(<span class="kw">levels</span>(pos))</code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    2    1
## [3,]    1    2
## [4,]    2    2</code></pre>
<p>In order to try the remaining structures on our test data we re-interpret the time factor using <code>numFactor</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1$times &lt;-<span class="st"> </span><span class="kw">numFactor</span>(dat1$times)
<span class="kw">levels</span>(dat1$times)</code></pre></div>
<pre><code>## [1] &quot;(1)&quot; &quot;(2)&quot; &quot;(3)&quot; &quot;(4)&quot; &quot;(5)&quot; &quot;(6)&quot;</code></pre>
</div>
<div id="ornsteinuhlenbeck" class="section level2">
<h2>Ornstein–Uhlenbeck</h2>
<p>Having the numeric times encoded in the factor levels we can now try the Ornstein–Uhlenbeck covariance structure.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.ou &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">ou</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1)
fit.ou$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>It should give the exact same results as <code>ar1</code> in this case since the times are equidistant:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.ou)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.0034                                 
##           times(2) 1.0034   0.721                         
##           times(3) 1.0034   0.520 0.721                   
##           times(4) 1.0034   0.375 0.520 0.721             
##           times(5) 1.0034   0.270 0.375 0.520 0.721       
##           times(6) 1.0034   0.195 0.270 0.375 0.520 0.721 
##  Residual          1.0187</code></pre>
<p>However, note the differences between <code>ou</code> and <code>ar1</code>:</p>
<ul>
<li><code>ou</code> can handle irregular time points.</li>
<li><code>ou</code> only allows positive correlation between neighboring time points.</li>
</ul>
</div>
<div id="spatial-correlations" class="section level2">
<h2>Spatial correlations</h2>
<p>The structures <code>exp</code>, <code>gau</code> and <code>mat</code> are meant to used for spatial data. They all require a Euclidean distance matrix which is calculated internally based on the coordinates. Here, we will try these models on the simulated time series data.</p>
<p>An example with spatial data is presented in a later section.</p>
<div id="matern" class="section level3">
<h3>Matern</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.mat &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">mat</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span>~<span class="dv">0</span>)
fit.mat$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.mat)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.43                                   
##         times(2) 1.43     0.357                         
##         times(3) 1.43     0.250 0.357                   
##         times(4) 1.43     0.187 0.250 0.357             
##         times(5) 1.43     0.143 0.187 0.250 0.357       
##         times(6) 1.43     0.111 0.143 0.187 0.250 0.357</code></pre>
</div>
<div id="gaussian" class="section level3">
<h3>Gaussian</h3>
<p>“Gaussian” refers here to a Gaussian decay in correlation with distance, i.e. <span class="math inline">\(\rho = \exp(-d x^2)\)</span>, not to the conditional distribution (“family”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.gau &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">gau</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span>~<span class="dv">0</span>)
fit.gau$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.gau)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.4175                                 
##         times(2) 1.4175   0.280                         
##         times(3) 1.4175   0.006 0.280                   
##         times(4) 1.4175   0.000 0.006 0.280             
##         times(5) 1.4175   0.000 0.000 0.006 0.280       
##         times(6) 1.4175   0.000 0.000 0.000 0.006 0.280</code></pre>
</div>
<div id="exponential" class="section level3">
<h3>Exponential</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit.exp &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y ~<span class="st"> </span><span class="kw">exp</span>(times +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>dat1)
fit.exp$sdr$pdHess ## Converged ?</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">VarCorr</span>(fit.exp)</code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.0034                                 
##           times(2) 1.0034   0.721                         
##           times(3) 1.0034   0.520 0.721                   
##           times(4) 1.0034   0.375 0.520 0.721             
##           times(5) 1.0034   0.270 0.375 0.520 0.721       
##           times(6) 1.0034   0.195 0.270 0.375 0.520 0.721 
##  Residual          1.0187</code></pre>
</div>
<div id="a-spatial-covariance-example" class="section level3">
<h3>A spatial covariance example</h3>
<p>Starting out with the built in <code>volcano</code> dataset we reshape it to a <code>data.frame</code> with pixel intensity <code>z</code> and pixel position <code>x</code> and <code>y</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z =</span> <span class="kw">as.vector</span>(volcano),
                <span class="dt">x =</span> <span class="kw">as.vector</span>(<span class="kw">row</span>(volcano)),
                <span class="dt">y =</span> <span class="kw">as.vector</span>(<span class="kw">col</span>(volcano)))</code></pre></div>
<p>Next, add random normal noise to the pixel intensities and extract a small subset of 100 pixels. This is our spatial dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
d$z &lt;-<span class="st"> </span>d$z +<span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(volcano), <span class="dt">sd=</span><span class="dv">15</span>)
d &lt;-<span class="st"> </span>d[<span class="kw">sample</span>(<span class="kw">nrow</span>(d), <span class="dv">100</span>), ]</code></pre></div>
<p>Display sampled noisy volcano data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">volcano.data &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="kw">dim</span>(volcano))
volcano.data[<span class="kw">cbind</span>(d$x, d$y)] &lt;-<span class="st"> </span>d$z
<span class="kw">image</span>(volcano.data, <span class="dt">main=</span><span class="st">&quot;Spatial data&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Based on this data, we’ll attempt to re-construct the original image.</p>
<p>As model, it is assumed that the original image <code>image(volcano)</code> is a realization of a random field with correlation decaying exponentially with distance between pixels.</p>
<p>Denoting by <span class="math inline">\(u(x,y)\)</span> this random field the model for the observations is</p>
<p><span class="math display">\[ z_{i} = \mu + u(x_i,y_i) + \varepsilon_i \]</span></p>
<p>To fit the model, a <code>numFactor</code> and a dummy grouping variable must be added to the dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d$pos &lt;-<span class="st"> </span><span class="kw">numFactor</span>(d$x, d$y)
d$group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(d)))</code></pre></div>
<p>The model is fit by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(z ~<span class="st"> </span><span class="dv">1</span> +<span class="st"> </span><span class="kw">exp</span>(pos +<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span>group), <span class="dt">data=</span>d)</code></pre></div>
<p>Recall that a standard deviation <code>sd=15</code> was used to distort the image. A confidence interval for this parameter is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(f, <span class="st">&quot;sigma&quot;</span>)</code></pre></div>
<pre><code>##                      2.5 % 97.5 % Estimate
## Std.Dev.pos(41,3) 15.98407 51.403 28.66408</code></pre>
<p>The glmmTMB <code>predict</code> method can predict unseen levels of the random effects. For instance to predict a 3-by-3 corner of the image one could construct the new data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pos=</span><span class="kw">numFactor</span>(<span class="kw">expand.grid</span>(<span class="dt">x=</span><span class="dv">1</span>:<span class="dv">3</span>,<span class="dt">y=</span><span class="dv">1</span>:<span class="dv">3</span>)) )
newdata$group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(newdata)))
newdata</code></pre></div>
<pre><code>##     pos group
## 1 (1,1)     1
## 2 (2,1)     1
## 3 (3,1)     1
## 4 (1,2)     1
## 5 (2,2)     1
## 6 (3,2)     1
## 7 (1,3)     1
## 8 (2,3)     1
## 9 (3,3)     1</code></pre>
<p>and predict using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(f, newdata, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels=</span><span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] 114.3405 115.2834 116.2061 114.6033 115.6916 116.7725 114.7828 116.0382
## [9] 117.3101</code></pre>
<p>A specific image column can thus be predicted using the function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predict_col &lt;-<span class="st"> </span>function(i) {
    newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pos =</span> <span class="kw">numFactor</span>(<span class="kw">expand.grid</span>(<span class="dv">1</span>:<span class="dv">87</span>,i)))
    newdata$group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(newdata)))
    <span class="kw">predict</span>(f, <span class="dt">newdata=</span>newdata, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels=</span><span class="ot">TRUE</span>)
}</code></pre></div>
<p>Prediction of the entire image is carried out by (this takes a while…):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span>:<span class="dv">61</span>, predict_col)</code></pre></div>
<p>Finally plot the re-constructed image by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">image</span>(pred, <span class="dt">main=</span><span class="st">&quot;Reconstruction&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="mappings" class="section level2">
<h2>Mappings</h2>
<p>For various advanced purposes, such as computing likelihood profiles, it is useful to know the details of the parameterization of the models - the scale on which the parameters are defined (e.g. standard deviation, variance, or log-standard deviation for variance parameters) and their order.</p>
<div id="unstructured" class="section level3">
<h3>Unstructured</h3>
<p>For an unstructured matrix of size <code>n</code>, parameters <code>1:n</code> represent the log-standard deviations while the remaining <code>n(n-1)/2</code> (i.e. <code>(n+1):(n:(n*(n+1)/2))</code>) are the elements of the <em>scaled</em> Cholesky factor of the correlation matrix, filled in row-wise order (see <a href="http://kaskr.github.io/adcomp/classUNSTRUCTURED__CORR__t.html">TMB documentation</a>). In particular, if <span class="math inline">\(L\)</span> is the lower-triangular matrix with 1 on the diagonal and the correlation parameters in the lower triangle, then the correlation matrix is defined as <span class="math inline">\(\Sigma = D^{-1/2} L L^\top D^{-1/2}\)</span>, where <span class="math inline">\(D = \textrm{diag}(L L^\top)\)</span>. For a single correlation parameter <span class="math inline">\(\theta_0\)</span>, this works out to <span class="math inline">\(\rho = \theta_0/(1+\theta_0^2)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vv0 &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.us)
vv1 &lt;-<span class="st"> </span>vv0$cond$group          ## extract 'naked' V-C matrix
n &lt;-<span class="st"> </span><span class="kw">nrow</span>(vv1)
rpars &lt;-<span class="st"> </span><span class="kw">getME</span>(fit.us,<span class="st">&quot;theta&quot;</span>) ## extract V-C parameters
## first n parameters are log-std devs:
<span class="kw">all.equal</span>(<span class="kw">unname</span>(<span class="kw">diag</span>(vv1)),<span class="kw">exp</span>(rpars[<span class="dv">1</span>:n])^<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## now try correlation parameters:
cpars &lt;-<span class="st"> </span>rpars[-(<span class="dv">1</span>:n)]
<span class="kw">length</span>(cpars)==n*(n<span class="dv">-1</span>)/<span class="dv">2</span>      ## the expected number</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cc &lt;-<span class="st"> </span><span class="kw">diag</span>(n)
cc[<span class="kw">upper.tri</span>(cc)] &lt;-<span class="st"> </span>cpars
L &lt;-<span class="st"> </span><span class="kw">crossprod</span>(cc)
D &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span>/<span class="kw">sqrt</span>(<span class="kw">diag</span>(L)))
D %*%<span class="st"> </span>L %*%<span class="st"> </span>D</code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
## [1,] 1.0000000 0.3534512 0.2727980 0.1655882 0.1600074 0.1076347
## [2,] 0.3534512 1.0000000 0.3840501 0.2164547 0.1920124 0.1363967
## [3,] 0.2727980 0.3840501 1.0000000 0.3519410 0.2394707 0.1949194
## [4,] 0.1655882 0.2164547 0.3519410 1.0000000 0.3543413 0.2731235
## [5,] 0.1600074 0.1920124 0.2394707 0.3543413 1.0000000 0.3445276
## [6,] 0.1076347 0.1363967 0.1949194 0.2731235 0.3445276 1.0000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unname</span>(<span class="kw">attr</span>(vv1,<span class="st">&quot;correlation&quot;</span>))</code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
## [1,] 1.0000000 0.3534512 0.2727980 0.1655882 0.1600074 0.1076347
## [2,] 0.3534512 1.0000000 0.3840501 0.2164547 0.1920124 0.1363967
## [3,] 0.2727980 0.3840501 1.0000000 0.3519410 0.2394707 0.1949194
## [4,] 0.1655882 0.2164547 0.3519410 1.0000000 0.3543413 0.2731235
## [5,] 0.1600074 0.1920124 0.2394707 0.3543413 1.0000000 0.3445276
## [6,] 0.1076347 0.1363967 0.1949194 0.2731235 0.3445276 1.0000000</code></pre>
<blockquote>
<p>FIXME: why are these not quite the same? Not what I expected</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(<span class="kw">c</span>(<span class="kw">cov2cor</span>(vv1)),<span class="kw">c</span>(fit.us$obj$env$<span class="kw">report</span>(fit.us$fit$parfull)$corr[[<span class="dv">1</span>]]))</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Profiling (experimental/exploratory):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## want $par, not $parfull: do NOT include conditional modes/'b' parameters
ppar &lt;-<span class="st"> </span>fit.us$fit$par
<span class="kw">length</span>(ppar)</code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(<span class="kw">which</span>(<span class="kw">names</span>(ppar)==<span class="st">&quot;theta&quot;</span>)) ## the last n*(n+1)/2 parameters</code></pre></div>
<pre><code>## [1]  2 22</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## only 1 fixed effect parameter
tt &lt;-<span class="st"> </span><span class="kw">tmbprofile</span>(fit.us$obj,<span class="dv">2</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(tt)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(tt)</code></pre></div>
<pre><code>##           lower    upper
## theta 0.3026163 0.390288</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ppar &lt;-<span class="st"> </span>fit.cs$fit$par
<span class="kw">length</span>(ppar)</code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(<span class="kw">which</span>(<span class="kw">names</span>(ppar)==<span class="st">&quot;theta&quot;</span>)) ## the last n*(n+1)/2 parameters</code></pre></div>
<pre><code>## [1] 2 8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## only 1 fixed effect parameter, 1 dispersion parameter
tt2 &lt;-<span class="st"> </span><span class="kw">tmbprofile</span>(fit.cs$obj,<span class="dv">3</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(tt2)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
